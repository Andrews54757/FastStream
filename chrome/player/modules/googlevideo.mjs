/* eslint-disable */
/* LuanRT/googlevideo */
// Minified to reduce loading time (https://minify-js.com/)
var e=Object.defineProperty,t=(t,i)=>e(t,"name",{value:i,configurable:!0}),i=2147483647,n=1,a=2;function s(e){var t;if(!e)return;const i=null==(t=e.split("=")[1])?void 0:t.split("-");if(null==i?void 0:i.length){return{start:Number(i[0]),end:Number(i[1])}}}function r(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),i=t.padEnd(t.length+(4-t.length%4)%4,"=");return new Uint8Array(atob(i).split("").map((e=>e.charCodeAt(0))))}function o(e){const t=e.reduce(((e,t)=>e+t.length),0),i=new Uint8Array(t);let n=0;for(const t of e)i.set(t,n),n+=t.length;return i}t(s,"parseRangeHeader"),t(r,"base64ToU8"),t(o,"concatenateChunks");function c(e,t){return`${e||""}:${t||""}`}function d(e){if(e)return c(e.itag,e.xtags)}function u(e){return c(e.itag,e.xtags)}function l(e){return e.formatId?c(e.formatId.itag,e.formatId.xtags):""}function f(e,t){return e.isInitSeg&&t?`${e.itag}:${e.xtags||""}:${t.contentLength||""}:${t.mimeType||""}`:`${e.startRange||"0"}-${e.itag}-${e.xtags||""}`}function h(e){if(!e.byteRange||!e.format)throw new Error("Invalid metadata: byteRange or format is missing");return f({itag:e.format.itag,xtags:e.format.xtags||"",startRange:e.byteRange.start,isInitSeg:e.isInit},e.isInit?e.format:void 0)}function b(e){if(e.width)return e.itag.toString();const t=[e.itag.toString()];return e.audioTrackId&&t.push(e.audioTrackId),e.isDrc&&t.push("drc"),t.join("-")}((t,i)=>{for(var n in i)e(t,n,{get:i[n],enumerable:!0})})({},{createKey:()=>c,createSegmentCacheKey:()=>f,createSegmentCacheKeyFromMetadata:()=>h,fromFormat:()=>d,fromFormatInitializationMetadata:()=>l,fromMediaHeader:()=>u,getUniqueFormatId:()=>b}),t(c,"createKey"),t(d,"fromFormat"),t(u,"fromMediaHeader"),t(l,"fromFormatInitializationMetadata"),t(f,"createSegmentCacheKey"),t(h,"createSegmentCacheKeyFromMetadata"),t(b,"getUniqueFormatId");var m={NONE:0,0:"NONE",ERROR:1,1:"ERROR",WARN:2,2:"WARN",INFO:3,3:"INFO",DEBUG:4,4:"DEBUG",ALL:99,99:"ALL"},g=class e{constructor(){this.currentLogLevels=new Set([m.INFO,m.ERROR])}static getInstance(){return e.instance||(e.instance=new e),e.instance}setLogLevels(...e){0===e.length||e.includes(m.NONE)?this.currentLogLevels=new Set:e.includes(m.ALL)?this.currentLogLevels=new Set([m.ERROR,m.WARN,m.INFO,m.DEBUG]):this.currentLogLevels=new Set(e.filter((e=>e!==m.NONE&&e!==m.ALL)))}getLogLevels(){return new Set(this.currentLogLevels)}log(e,t,...i){if(e!==m.NONE&&this.currentLogLevels.has(e)){const n=`[${m[e]}] [${t}]`;switch(e){case m.ERROR:console.error(n,...i);break;case m.WARN:console.warn(n,...i);break;case m.INFO:console.info(n,...i);break;case m.DEBUG:console.debug(n,...i)}}}error(e,...t){this.log(m.ERROR,e,...t)}warn(e,...t){this.log(m.WARN,e,...t)}info(e,...t){this.log(m.INFO,e,...t)}debug(e,...t){this.log(m.DEBUG,e,...t)}};t(g,"Logger");var p=g,k="CacheManager",v=class{constructor(e=50,t=600){this.initSegmentCache=new Map,this.segmentCache=new Map,this.currentSize=0,this.logger=p.getInstance(),this.maxCacheSize=1024*e*1024,this.maxAge=1e3*t,this.startGarbageCollection()}getCacheEntries(){return{initSegmentCache:this.initSegmentCache,segmentCache:this.segmentCache}}setInitSegment(e,t){const i={data:t,timestamp:Date.now(),size:t.byteLength};this.initSegmentCache.has(e)||(this.currentSize+=i.size,this.enforceStorageLimit()),this.initSegmentCache.set(e,i)}setSegment(e,t){const i={data:t,timestamp:Date.now(),size:t.byteLength};this.currentSize+=i.size,this.enforceStorageLimit(),this.segmentCache.set(e,i)}getInitSegment(e){const t=this.initSegmentCache.get(e);if(t&&!this.isExpired(t))return this.logger.debug(k,`Cache hit for init segment: ${e}`),t.timestamp=Date.now(),t.data;t&&(this.initSegmentCache.delete(e),this.currentSize-=t.size)}getSegment(e){const t=this.segmentCache.get(e);if(t&&!this.isExpired(t)){this.logger.debug(k,`Cache hit for segment: ${e}`);const i=t.data;return this.segmentCache.delete(e),this.currentSize-=t.size,i}t&&(this.segmentCache.delete(e),this.currentSize-=t.size)}isExpired(e){return Date.now()-e.timestamp>this.maxAge}enforceStorageLimit(){this.currentSize<=this.maxCacheSize||(this.clearExpiredEntries(),this.currentSize>this.maxCacheSize&&this.removeOldestEntries())}clearExpiredEntries(){const e=Date.now();for(const[t,i]of this.segmentCache.entries())e-i.timestamp>this.maxAge&&(this.logger.debug(k,`Removing expired segment from cache: ${t}`),this.segmentCache.delete(t),this.currentSize-=i.size);for(const[t,i]of this.initSegmentCache.entries())e-i.timestamp>this.maxAge&&(this.logger.debug(k,`Removing expired init segment from cache: ${t}`),this.initSegmentCache.delete(t),this.currentSize-=i.size)}removeOldestEntries(){const e=[...Array.from(this.segmentCache.entries()),...Array.from(this.initSegmentCache.entries())].sort(((e,t)=>e[1].timestamp-t[1].timestamp));for(;this.currentSize>this.maxCacheSize&&e.length>0;){const[t,i]=e.shift();this.segmentCache.delete(t),this.initSegmentCache.delete(t),this.currentSize-=i.size}}startGarbageCollection(){this.timerId=setInterval((()=>{this.clearExpiredEntries()}),6e4)}dispose(){this.initSegmentCache.clear(),this.segmentCache.clear(),this.currentSize=0,this.timerId&&(clearInterval(this.timerId),this.timerId=void 0),this.logger.debug(k,"Disposed")}};t(v,"CacheManager");var y=v;var w=class extends Error{constructor(e,t){super(`[SabrStreamingAdapter] ${e}`),this.code=t,this.name="SabrAdapterError"}};t(w,"SabrAdapterError");var M=w;var S=class{constructor(){this.CLEANUP_INTERVAL=3e4,this.ENTRY_EXPIRATION_TIME=18e4,this.metadataMap=new Map,this.lastCleanup=Date.now()}getRequestMetadata(e,t=!1){const i=new URL(e).searchParams.get("rn")||"",n=this.metadataMap.get(i);if(!(n&&Date.now()-n.timestamp>this.ENTRY_EXPIRATION_TIME))return t&&this.metadataMap.delete(i),this.conditionalCleanUp(),n;this.metadataMap.delete(i)}setRequestMetadata(e,t){const i=new URL(e).searchParams.get("rn");i&&(this.metadataMap.set(i,t),this.conditionalCleanUp())}conditionalCleanUp(){const e=Date.now();e-this.lastCleanup>this.CLEANUP_INTERVAL&&(this.cleanUp(),this.lastCleanup=e)}cleanUp(){for(const[e,t]of this.metadataMap.entries())Date.now()-t.timestamp>this.ENTRY_EXPIRATION_TIME&&this.metadataMap.delete(e)}};t(S,"RequestMetadataManager");var I=S;function R(){let e=0,t=0;for(let i=0;i<28;i+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}let i=this.buf[this.pos++];if(e|=(15&i)<<28,t=(112&i)>>4,0==(128&i))return this.assertBounds(),[e,t];for(let i=3;i<=31;i+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function C(e,t,i){for(let n=0;n<28;n+=7){const a=e>>>n,s=!(a>>>7==0&&0==t),r=255&(s?128|a:a);if(i.push(r),!s)return}const n=e>>>28&15|(7&t)<<4,a=!(t>>3==0);if(i.push(255&(a?128|n:n)),a){for(let e=3;e<31;e+=7){const n=t>>>e,a=!(n>>>7==0),s=255&(a?128|n:n);if(i.push(s),!a)return}i.push(t>>>31&1)}}t(R,"varint64read"),t(C,"varint64write");var T=4294967296;function E(e){const i="-"===e[0];i&&(e=e.slice(1));const n=1e6;let a=0,s=0;function r(t,i){const r=Number(e.slice(t,i));s*=n,a=a*n+r,a>=T&&(s+=a/T|0,a%=T)}return t(r,"add1e6digit"),r(-24,-18),r(-18,-12),r(-12,-6),r(-6),i?N(a,s):A(a,s)}function x(e,t){let i=A(e,t);const n=2147483648&i.hi;n&&(i=N(i.lo,i.hi));const a=B(i.lo,i.hi);return n?"-"+a:a}function B(e,t){if(({lo:e,hi:t}=P(e,t)),t<=2097151)return String(T*t+e);const i=16777215&(e>>>24|t<<8),n=t>>16&65535;let a=(16777215&e)+6777216*i+6710656*n,s=i+8147497*n,r=2*n;const o=1e7;return a>=o&&(s+=Math.floor(a/o),a%=o),s>=o&&(r+=Math.floor(s/o),s%=o),r.toString()+F(s)+F(a)}function P(e,t){return{lo:e>>>0,hi:t>>>0}}function A(e,t){return{lo:0|e,hi:0|t}}function N(e,t){return t=~t,e?e=1+~e:t+=1,A(e,t)}t(E,"int64FromString"),t(x,"int64ToString"),t(B,"uInt64ToString"),t(P,"toUnsigned"),t(A,"newBits"),t(N,"negate");var F=t((e=>{const t=String(e);return"0000000".slice(t.length)+t}),"decimalFrom1e7WithLeadingZeros");function U(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let i=0;i<9;i++)t.push(127&e|128),e>>=7;t.push(1)}}function L(){let e=this.buf[this.pos++],t=127&e;if(0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,0==(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let t=5;0!=(128&e)&&t<10;t++)e=this.buf[this.pos++];if(0!=(128&e))throw new Error("invalid varint");return this.assertBounds(),t>>>0}t(U,"varint32write"),t(L,"varint32read");var V=D();function D(){const e=new DataView(new ArrayBuffer(8));if("function"==typeof BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64&&("object"!=typeof process||"object"!=typeof process.env||"1"!==process.env.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),i=BigInt("9223372036854775807"),n=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const n="bigint"==typeof e?e:BigInt(e);if(n>i||n<t)throw new Error(`invalid int64: ${e}`);return n},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>a||t<n)throw new Error(`invalid uint64: ${e}`);return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,i)=>(e.setInt32(0,t,!0),e.setInt32(4,i,!0),e.getBigInt64(0,!0)),uDec:(t,i)=>(e.setInt32(0,t,!0),e.setInt32(4,i,!0),e.getBigUint64(0,!0))}}return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),q(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),_(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),q(e),E(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),_(e),E(e)),dec:(e,t)=>x(e,t),uDec:(e,t)=>B(e,t)}}function q(e){if(!/^-?[0-9]+$/.test(e))throw new Error("invalid int64: "+e)}function _(e){if(!/^[0-9]+$/.test(e))throw new Error("invalid uint64: "+e)}t(D,"makeInt64Support"),t(q,"assertInt64String"),t(_,"assertUInt64String");var O,H,j=Symbol.for("@bufbuild/protobuf/text-encoding");function z(){if(null==globalThis[j]){const e=new globalThis.TextEncoder,t=new globalThis.TextDecoder;globalThis[j]={encodeUtf8:t=>e.encode(t),decodeUtf8:e=>t.decode(e),checkUtf8(e){try{return encodeURIComponent(e),!0}catch(e){return!1}}}}return globalThis[j]}t(z,"getTextEncoding"),(H=O||(O={}))[H.Varint=0]="Varint",H[H.Bit64=1]="Bit64",H[H.LengthDelimited=2]="LengthDelimited",H[H.StartGroup=3]="StartGroup",H[H.EndGroup=4]="EndGroup",H[H.Bit32=5]="Bit32";var G=class{constructor(e=z().encodeUtf8){this.encodeUtf8=e,this.stack=[],this.chunks=[],this.buf=[]}finish(){this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]);let e=0;for(let t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;let t=new Uint8Array(e),i=0;for(let e=0;e<this.chunks.length;e++)t.set(this.chunks[e],i),i+=this.chunks[e].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(K(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return Q(e),U(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.encodeUtf8(e);return this.uint32(t.byteLength),this.raw(t)}float(e){Z(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){K(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){Q(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return Q(e),U(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),n=V.enc(e);return i.setInt32(0,n.lo,!0),i.setInt32(4,n.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),n=V.uEnc(e);return i.setInt32(0,n.lo,!0),i.setInt32(4,n.hi,!0),this.raw(t)}int64(e){let t=V.enc(e);return C(t.lo,t.hi,this.buf),this}sint64(e){const t=V.enc(e),i=t.hi>>31;return C(t.lo<<1^i,(t.hi<<1|t.lo>>>31)^i,this.buf),this}uint64(e){const t=V.uEnc(e);return C(t.lo,t.hi,this.buf),this}};t(G,"BinaryWriter");var W=G,$=class{constructor(e,t=z().decodeUtf8){this.decodeUtf8=t,this.varint64=R,this.uint32=L,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength)}tag(){let e=this.uint32(),t=e>>>3,i=7&e;if(t<=0||i<0||i>5)throw new Error("illegal tag: field no "+t+" wire type "+i);return[t,i]}skip(e,t){let i=this.pos;switch(e){case O.Varint:for(;128&this.buf[this.pos++];);break;case O.Bit64:this.pos+=4;case O.Bit32:this.pos+=4;break;case O.LengthDelimited:let i=this.uint32();this.pos+=i;break;case O.StartGroup:for(;;){const[e,i]=this.tag();if(i===O.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(i,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return V.dec(...this.varint64())}uint64(){return V.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),i=-(1&e);return e=(e>>>1|(1&t)<<31)^i,t=t>>>1^i,V.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return V.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return V.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.decodeUtf8(this.bytes())}};t($,"BinaryReader");var X=$;function Q(e){if("string"==typeof e)e=Number(e);else if("number"!=typeof e)throw new Error("invalid int32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int32: "+e)}function K(e){if("string"==typeof e)e=Number(e);else if("number"!=typeof e)throw new Error("invalid uint32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint32: "+e)}function Z(e){if("string"==typeof e){const t=e;if(e=Number(e),Number.isNaN(e)&&"NaN"!==t)throw new Error("invalid float32: "+t)}else if("number"!=typeof e)throw new Error("invalid float32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float32: "+e)}function Y(){return{itag:0,lastModified:0,xtags:""}}t(Q,"assertInt32"),t(K,"assertUInt32"),t(Z,"assertFloat32"),t(Y,"createBaseFormatId");var J={encode:(e,t=new W)=>(void 0!==e.itag&&0!==e.itag&&t.uint32(8).int32(e.itag),void 0!==e.lastModified&&0!==e.lastModified&&t.uint32(16).uint64(e.lastModified),void 0!==e.xtags&&""!==e.xtags&&t.uint32(26).string(e.xtags),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={itag:0,lastModified:0,xtags:""};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8!==e)break;a.itag=i.int32();continue;case 2:if(16!==e)break;a.lastModified=re(i.uint64());continue;case 3:if(26!==e)break;a.xtags=i.string();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function ee(){return{legacyStart:0,legacyEnd:0,start:0,end:0}}t(ee,"createBaseRange");var te={encode:(e,t=new W)=>(void 0!==e.legacyStart&&0!==e.legacyStart&&t.uint32(8).int32(e.legacyStart),void 0!==e.legacyEnd&&0!==e.legacyEnd&&t.uint32(16).int32(e.legacyEnd),void 0!==e.start&&0!==e.start&&t.uint32(24).int32(e.start),void 0!==e.end&&0!==e.end&&t.uint32(32).int32(e.end),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={legacyStart:0,legacyEnd:0,start:0,end:0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8!==e)break;a.legacyStart=i.int32();continue;case 2:if(16!==e)break;a.legacyEnd=i.int32();continue;case 3:if(24!==e)break;a.start=i.int32();continue;case 4:if(32!==e)break;a.end=i.int32();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function ie(){return{trackType:0,isHdr:!1}}t(ie,"createBaseAuthorizedFormat");var ne={encode:(e,t=new W)=>(void 0!==e.trackType&&0!==e.trackType&&t.uint32(8).int32(e.trackType),void 0!==e.isHdr&&!1!==e.isHdr&&t.uint32(16).bool(e.isHdr),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={trackType:0,isHdr:!1};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8!==e)break;a.trackType=i.int32();continue;case 2:if(16!==e)break;a.isHdr=i.bool();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function ae(){return{authorizedFormats:[],sabrLicenseConstraint:new Uint8Array(0)}}t(ae,"createBasePlaybackAuthorization");var se={encode(e,t=new W){for(const i of e.authorizedFormats)ne.encode(i,t.uint32(10).fork()).join();return void 0!==e.sabrLicenseConstraint&&0!==e.sabrLicenseConstraint.length&&t.uint32(18).bytes(e.sabrLicenseConstraint),t},decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a=ae();for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.authorizedFormats.push(ne.decode(i,i.uint32()));continue;case 2:if(18!==e)break;a.sabrLicenseConstraint=i.bytes();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function re(e){const t=globalThis.Number(e.toString());if(t>globalThis.Number.MAX_SAFE_INTEGER)throw new globalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");if(t<globalThis.Number.MIN_SAFE_INTEGER)throw new globalThis.Error("Value is smaller than Number.MIN_SAFE_INTEGER");return t}function oe(){return{videoId:"",formatId:void 0,endTimeMs:0,endSegmentNumber:0,mimeType:"",initRange:void 0,indexRange:void 0,field8:0,durationUnits:0,durationTimescale:0}}t(re,"longToNumber"),t(oe,"createBaseFormatInitializationMetadata");var ce={encode:(e,t=new W)=>(void 0!==e.videoId&&""!==e.videoId&&t.uint32(10).string(e.videoId),void 0!==e.formatId&&J.encode(e.formatId,t.uint32(18).fork()).join(),void 0!==e.endTimeMs&&0!==e.endTimeMs&&t.uint32(24).int64(e.endTimeMs),void 0!==e.endSegmentNumber&&0!==e.endSegmentNumber&&t.uint32(32).int64(e.endSegmentNumber),void 0!==e.mimeType&&""!==e.mimeType&&t.uint32(42).string(e.mimeType),void 0!==e.initRange&&te.encode(e.initRange,t.uint32(50).fork()).join(),void 0!==e.indexRange&&te.encode(e.indexRange,t.uint32(58).fork()).join(),void 0!==e.field8&&0!==e.field8&&t.uint32(64).int64(e.field8),void 0!==e.durationUnits&&0!==e.durationUnits&&t.uint32(72).int64(e.durationUnits),void 0!==e.durationTimescale&&0!==e.durationTimescale&&t.uint32(80).int64(e.durationTimescale),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={videoId:"",formatId:void 0,endTimeMs:0,endSegmentNumber:0,mimeType:"",initRange:void 0,indexRange:void 0,field8:0,durationUnits:0,durationTimescale:0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.videoId=i.string();continue;case 2:if(18!==e)break;a.formatId=J.decode(i,i.uint32());continue;case 3:if(24!==e)break;a.endTimeMs=de(i.int64());continue;case 4:if(32!==e)break;a.endSegmentNumber=de(i.int64());continue;case 5:if(42!==e)break;a.mimeType=i.string();continue;case 6:if(50!==e)break;a.initRange=te.decode(i,i.uint32());continue;case 7:if(58!==e)break;a.indexRange=te.decode(i,i.uint32());continue;case 8:if(64!==e)break;a.field8=de(i.int64());continue;case 9:if(72!==e)break;a.durationUnits=de(i.int64());continue;case 10:if(80!==e)break;a.durationTimescale=de(i.int64());continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function de(e){const t=globalThis.Number(e.toString());if(t>globalThis.Number.MAX_SAFE_INTEGER)throw new globalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");if(t<globalThis.Number.MIN_SAFE_INTEGER)throw new globalThis.Error("Value is smaller than Number.MIN_SAFE_INTEGER");return t}function ue(){return{startTicks:0,durationTicks:0,timescale:0}}t(de,"longToNumber"),t(ue,"createBaseTimeRange");var le={encode:(e,t=new W)=>(void 0!==e.startTicks&&0!==e.startTicks&&t.uint32(8).int64(e.startTicks),void 0!==e.durationTicks&&0!==e.durationTicks&&t.uint32(16).int64(e.durationTicks),void 0!==e.timescale&&0!==e.timescale&&t.uint32(24).int32(e.timescale),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={startTicks:0,durationTicks:0,timescale:0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8!==e)break;a.startTicks=fe(i.int64());continue;case 2:if(16!==e)break;a.durationTicks=fe(i.int64());continue;case 3:if(24!==e)break;a.timescale=i.int32();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function fe(e){const t=globalThis.Number(e.toString());if(t>globalThis.Number.MAX_SAFE_INTEGER)throw new globalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");if(t<globalThis.Number.MIN_SAFE_INTEGER)throw new globalThis.Error("Value is smaller than Number.MIN_SAFE_INTEGER");return t}function he(){return{headerId:0,videoId:"",itag:0,lmt:0,xtags:"",startRange:0,compressionAlgorithm:0,isInitSeg:!1,sequenceNumber:0,bitrateBps:0,startMs:0,durationMs:0,formatId:void 0,contentLength:0,timeRange:void 0,sequenceLmt:0}}t(fe,"longToNumber"),t(he,"createBaseMediaHeader");var be={encode:(e,t=new W)=>(void 0!==e.headerId&&0!==e.headerId&&t.uint32(8).uint32(e.headerId),void 0!==e.videoId&&""!==e.videoId&&t.uint32(18).string(e.videoId),void 0!==e.itag&&0!==e.itag&&t.uint32(24).int32(e.itag),void 0!==e.lmt&&0!==e.lmt&&t.uint32(32).uint64(e.lmt),void 0!==e.xtags&&""!==e.xtags&&t.uint32(42).string(e.xtags),void 0!==e.startRange&&0!==e.startRange&&t.uint32(48).int64(e.startRange),void 0!==e.compressionAlgorithm&&0!==e.compressionAlgorithm&&t.uint32(56).int32(e.compressionAlgorithm),void 0!==e.isInitSeg&&!1!==e.isInitSeg&&t.uint32(64).bool(e.isInitSeg),void 0!==e.sequenceNumber&&0!==e.sequenceNumber&&t.uint32(72).int64(e.sequenceNumber),void 0!==e.bitrateBps&&0!==e.bitrateBps&&t.uint32(80).int64(e.bitrateBps),void 0!==e.startMs&&0!==e.startMs&&t.uint32(88).int64(e.startMs),void 0!==e.durationMs&&0!==e.durationMs&&t.uint32(96).int64(e.durationMs),void 0!==e.formatId&&J.encode(e.formatId,t.uint32(106).fork()).join(),void 0!==e.contentLength&&0!==e.contentLength&&t.uint32(112).int64(e.contentLength),void 0!==e.timeRange&&le.encode(e.timeRange,t.uint32(122).fork()).join(),void 0!==e.sequenceLmt&&0!==e.sequenceLmt&&t.uint32(128).uint64(e.sequenceLmt),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={headerId:0,videoId:"",itag:0,lmt:0,xtags:"",startRange:0,compressionAlgorithm:0,isInitSeg:!1,sequenceNumber:0,bitrateBps:0,startMs:0,durationMs:0,formatId:void 0,contentLength:0,timeRange:void 0,sequenceLmt:0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8!==e)break;a.headerId=i.uint32();continue;case 2:if(18!==e)break;a.videoId=i.string();continue;case 3:if(24!==e)break;a.itag=i.int32();continue;case 4:if(32!==e)break;a.lmt=me(i.uint64());continue;case 5:if(42!==e)break;a.xtags=i.string();continue;case 6:if(48!==e)break;a.startRange=me(i.int64());continue;case 7:if(56!==e)break;a.compressionAlgorithm=i.int32();continue;case 8:if(64!==e)break;a.isInitSeg=i.bool();continue;case 9:if(72!==e)break;a.sequenceNumber=me(i.int64());continue;case 10:if(80!==e)break;a.bitrateBps=me(i.int64());continue;case 11:if(88!==e)break;a.startMs=me(i.int64());continue;case 12:if(96!==e)break;a.durationMs=me(i.int64());continue;case 13:if(106!==e)break;a.formatId=J.decode(i,i.uint32());continue;case 14:if(112!==e)break;a.contentLength=me(i.int64());continue;case 15:if(122!==e)break;a.timeRange=le.decode(i,i.uint32());continue;case 16:if(128!==e)break;a.sequenceLmt=me(i.uint64());continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function me(e){const t=globalThis.Number(e.toString());if(t>globalThis.Number.MAX_SAFE_INTEGER)throw new globalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");if(t<globalThis.Number.MIN_SAFE_INTEGER)throw new globalThis.Error("Value is smaller than Number.MIN_SAFE_INTEGER");return t}function ge(){return{formatId:void 0,startTimeMs:0,durationMs:0,startSegmentIndex:0,endSegmentIndex:0,timeRange:void 0,field9:void 0,field11:void 0,field12:void 0}}t(me,"longToNumber"),t(ge,"createBaseBufferedRange");var pe={encode:(e,t=new W)=>(void 0!==e.formatId&&J.encode(e.formatId,t.uint32(10).fork()).join(),0!==e.startTimeMs&&t.uint32(16).int64(e.startTimeMs),0!==e.durationMs&&t.uint32(24).int64(e.durationMs),0!==e.startSegmentIndex&&t.uint32(32).int32(e.startSegmentIndex),0!==e.endSegmentIndex&&t.uint32(40).int32(e.endSegmentIndex),void 0!==e.timeRange&&le.encode(e.timeRange,t.uint32(50).fork()).join(),void 0!==e.field9&&ve.encode(e.field9,t.uint32(74).fork()).join(),void 0!==e.field11&&Se.encode(e.field11,t.uint32(90).fork()).join(),void 0!==e.field12&&Se.encode(e.field12,t.uint32(98).fork()).join(),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={formatId:void 0,startTimeMs:0,durationMs:0,startSegmentIndex:0,endSegmentIndex:0,timeRange:void 0,field9:void 0,field11:void 0,field12:void 0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.formatId=J.decode(i,i.uint32());continue;case 2:if(16!==e)break;a.startTimeMs=Ie(i.int64());continue;case 3:if(24!==e)break;a.durationMs=Ie(i.int64());continue;case 4:if(32!==e)break;a.startSegmentIndex=i.int32();continue;case 5:if(40!==e)break;a.endSegmentIndex=i.int32();continue;case 6:if(50!==e)break;a.timeRange=le.decode(i,i.uint32());continue;case 9:if(74!==e)break;a.field9=ve.decode(i,i.uint32());continue;case 11:if(90!==e)break;a.field11=Se.decode(i,i.uint32());continue;case 12:if(98!==e)break;a.field12=Se.decode(i,i.uint32());continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function ke(){return{field1:[]}}t(ke,"createBaseBufferedRange_UnknownMessage1");var ve={encode(e,t=new W){for(const i of e.field1)we.encode(i,t.uint32(10).fork()).join();return t},decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={field1:[]};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.field1.push(we.decode(i,i.uint32()));continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function ye(){return{videoId:"",lmt:0}}t(ye,"createBaseBufferedRange_UnknownMessage1_UnknownInnerMessage");var we={encode:(e,t=new W)=>(void 0!==e.videoId&&""!==e.videoId&&t.uint32(10).string(e.videoId),void 0!==e.lmt&&0!==e.lmt&&t.uint32(16).uint64(e.lmt),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={videoId:"",lmt:0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.videoId=i.string();continue;case 2:if(16!==e)break;a.lmt=Ie(i.uint64());continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function Me(){return{field1:0,field2:0,field3:0}}t(Me,"createBaseBufferedRange_UnknownMessage2");var Se={encode:(e,t=new W)=>(void 0!==e.field1&&0!==e.field1&&t.uint32(8).int32(e.field1),void 0!==e.field2&&0!==e.field2&&t.uint32(16).int32(e.field2),void 0!==e.field3&&0!==e.field3&&t.uint32(24).int32(e.field3),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={field1:0,field2:0,field3:0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8!==e)break;a.field1=i.int32();continue;case 2:if(16!==e)break;a.field2=i.int32();continue;case 3:if(24!==e)break;a.field3=i.int32();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function Ie(e){const t=globalThis.Number(e.toString());if(t>globalThis.Number.MAX_SAFE_INTEGER)throw new globalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");if(t<globalThis.Number.MIN_SAFE_INTEGER)throw new globalThis.Error("Value is smaller than Number.MIN_SAFE_INTEGER");return t}function Re(){return{videoFormatCapabilities:[],audioFormatCapabilities:[],hdrModeBitmask:0}}t(Ie,"longToNumber"),t(Re,"createBaseMediaCapabilities");var Ce={encode(e,t=new W){for(const i of e.videoFormatCapabilities)Ee.encode(i,t.uint32(10).fork()).join();for(const i of e.audioFormatCapabilities)Be.encode(i,t.uint32(18).fork()).join();return void 0!==e.hdrModeBitmask&&0!==e.hdrModeBitmask&&t.uint32(40).int32(e.hdrModeBitmask),t},decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={videoFormatCapabilities:[],audioFormatCapabilities:[],hdrModeBitmask:0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.videoFormatCapabilities.push(Ee.decode(i,i.uint32()));continue;case 2:if(18!==e)break;a.audioFormatCapabilities.push(Be.decode(i,i.uint32()));continue;case 5:if(40!==e)break;a.hdrModeBitmask=i.int32();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function Te(){return{videoCodec:0,maxHeight:0,maxWidth:0,maxFramerate:0,maxBitrateBps:0,is10BitSupported:!1}}t(Te,"createBaseMediaCapabilities_VideoFormatCapability");var Ee={encode:(e,t=new W)=>(void 0!==e.videoCodec&&0!==e.videoCodec&&t.uint32(8).int32(e.videoCodec),void 0!==e.maxHeight&&0!==e.maxHeight&&t.uint32(24).int32(e.maxHeight),void 0!==e.maxWidth&&0!==e.maxWidth&&t.uint32(32).int32(e.maxWidth),void 0!==e.maxFramerate&&0!==e.maxFramerate&&t.uint32(88).int32(e.maxFramerate),void 0!==e.maxBitrateBps&&0!==e.maxBitrateBps&&t.uint32(96).int32(e.maxBitrateBps),void 0!==e.is10BitSupported&&!1!==e.is10BitSupported&&t.uint32(120).bool(e.is10BitSupported),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={videoCodec:0,maxHeight:0,maxWidth:0,maxFramerate:0,maxBitrateBps:0,is10BitSupported:!1};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8!==e)break;a.videoCodec=i.int32();continue;case 3:if(24!==e)break;a.maxHeight=i.int32();continue;case 4:if(32!==e)break;a.maxWidth=i.int32();continue;case 11:if(88!==e)break;a.maxFramerate=i.int32();continue;case 12:if(96!==e)break;a.maxBitrateBps=i.int32();continue;case 15:if(120!==e)break;a.is10BitSupported=i.bool();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function xe(){return{audioCodec:0,numChannels:0,maxBitrateBps:0,spatialCapabilityBitmask:0}}t(xe,"createBaseMediaCapabilities_AudioFormatCapability");var Be={encode:(e,t=new W)=>(void 0!==e.audioCodec&&0!==e.audioCodec&&t.uint32(8).int32(e.audioCodec),void 0!==e.numChannels&&0!==e.numChannels&&t.uint32(16).int32(e.numChannels),void 0!==e.maxBitrateBps&&0!==e.maxBitrateBps&&t.uint32(24).int32(e.maxBitrateBps),void 0!==e.spatialCapabilityBitmask&&0!==e.spatialCapabilityBitmask&&t.uint32(48).int32(e.spatialCapabilityBitmask),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={audioCodec:0,numChannels:0,maxBitrateBps:0,spatialCapabilityBitmask:0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8!==e)break;a.audioCodec=i.int32();continue;case 2:if(16!==e)break;a.numChannels=i.int32();continue;case 3:if(24!==e)break;a.maxBitrateBps=i.int32();continue;case 6:if(48!==e)break;a.spatialCapabilityBitmask=i.int32();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function Pe(){return{resolution:0,field2:0,videoFmt:void 0,audioFmt:void 0}}t(Pe,"createBasePlaybackCookie");var Ae={encode:(e,t=new W)=>(void 0!==e.resolution&&0!==e.resolution&&t.uint32(8).int32(e.resolution),void 0!==e.field2&&0!==e.field2&&t.uint32(16).int32(e.field2),void 0!==e.videoFmt&&J.encode(e.videoFmt,t.uint32(58).fork()).join(),void 0!==e.audioFmt&&J.encode(e.audioFmt,t.uint32(66).fork()).join(),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={resolution:0,field2:0,videoFmt:void 0,audioFmt:void 0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8!==e)break;a.resolution=i.int32();continue;case 2:if(16!==e)break;a.field2=i.int32();continue;case 7:if(58!==e)break;a.videoFmt=J.decode(i,i.uint32());continue;case 8:if(66!==e)break;a.audioFmt=J.decode(i,i.uint32());continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function Ne(){return{timeSinceLastManualFormatSelectionMs:0,lastManualDirection:0,lastManualSelectedResolution:0,detailedNetworkType:0,clientViewportWidth:0,clientViewportHeight:0,clientBitrateCapBytesPerSec:0,stickyResolution:0,clientViewportIsFlexible:!1,bandwidthEstimate:0,minAudioQuality:0,maxAudioQuality:0,videoQualitySetting:0,audioRoute:0,playerTimeMs:0,timeSinceLastSeek:0,dataSaverMode:!1,networkMeteredState:0,visibility:0,playbackRate:0,elapsedWallTimeMs:0,mediaCapabilities:void 0,timeSinceLastActionMs:0,enabledTrackTypesBitfield:0,maxPacingRate:0,playerState:0,drcEnabled:!1,field48:0,field50:0,field51:0,sabrReportRequestCancellationInfo:0,disableStreamingXhr:!1,field57:0,preferVp9:!1,av1QualityThreshold:0,field60:0,isPrefetch:!1,sabrSupportQualityConstraints:!1,sabrLicenseConstraint:new Uint8Array(0),allowProximaLiveLatency:0,sabrForceProxima:0,field67:0,sabrForceMaxNetworkInterruptionDurationMs:0,audioTrackId:"",enableVoiceBoost:!1,playbackAuthorization:void 0}}t(Ne,"createBaseClientAbrState");var Fe={encode:(e,t=new W)=>(void 0!==e.timeSinceLastManualFormatSelectionMs&&0!==e.timeSinceLastManualFormatSelectionMs&&t.uint32(104).int64(e.timeSinceLastManualFormatSelectionMs),void 0!==e.lastManualDirection&&0!==e.lastManualDirection&&t.uint32(112).sint32(e.lastManualDirection),void 0!==e.lastManualSelectedResolution&&0!==e.lastManualSelectedResolution&&t.uint32(128).int32(e.lastManualSelectedResolution),void 0!==e.detailedNetworkType&&0!==e.detailedNetworkType&&t.uint32(136).int32(e.detailedNetworkType),void 0!==e.clientViewportWidth&&0!==e.clientViewportWidth&&t.uint32(144).int32(e.clientViewportWidth),void 0!==e.clientViewportHeight&&0!==e.clientViewportHeight&&t.uint32(152).int32(e.clientViewportHeight),void 0!==e.clientBitrateCapBytesPerSec&&0!==e.clientBitrateCapBytesPerSec&&t.uint32(160).int64(e.clientBitrateCapBytesPerSec),void 0!==e.stickyResolution&&0!==e.stickyResolution&&t.uint32(168).int32(e.stickyResolution),void 0!==e.clientViewportIsFlexible&&!1!==e.clientViewportIsFlexible&&t.uint32(176).bool(e.clientViewportIsFlexible),void 0!==e.bandwidthEstimate&&0!==e.bandwidthEstimate&&t.uint32(184).int64(e.bandwidthEstimate),void 0!==e.minAudioQuality&&0!==e.minAudioQuality&&t.uint32(192).int32(e.minAudioQuality),void 0!==e.maxAudioQuality&&0!==e.maxAudioQuality&&t.uint32(200).int32(e.maxAudioQuality),void 0!==e.videoQualitySetting&&0!==e.videoQualitySetting&&t.uint32(208).int32(e.videoQualitySetting),void 0!==e.audioRoute&&0!==e.audioRoute&&t.uint32(216).int32(e.audioRoute),void 0!==e.playerTimeMs&&0!==e.playerTimeMs&&t.uint32(224).int64(e.playerTimeMs),void 0!==e.timeSinceLastSeek&&0!==e.timeSinceLastSeek&&t.uint32(232).int64(e.timeSinceLastSeek),void 0!==e.dataSaverMode&&!1!==e.dataSaverMode&&t.uint32(240).bool(e.dataSaverMode),void 0!==e.networkMeteredState&&0!==e.networkMeteredState&&t.uint32(256).int32(e.networkMeteredState),void 0!==e.visibility&&0!==e.visibility&&t.uint32(272).int32(e.visibility),void 0!==e.playbackRate&&0!==e.playbackRate&&t.uint32(285).float(e.playbackRate),void 0!==e.elapsedWallTimeMs&&0!==e.elapsedWallTimeMs&&t.uint32(288).int64(e.elapsedWallTimeMs),void 0!==e.mediaCapabilities&&Ce.encode(e.mediaCapabilities,t.uint32(306).fork()).join(),void 0!==e.timeSinceLastActionMs&&0!==e.timeSinceLastActionMs&&t.uint32(312).int64(e.timeSinceLastActionMs),void 0!==e.enabledTrackTypesBitfield&&0!==e.enabledTrackTypesBitfield&&t.uint32(320).int32(e.enabledTrackTypesBitfield),void 0!==e.maxPacingRate&&0!==e.maxPacingRate&&t.uint32(344).int32(e.maxPacingRate),void 0!==e.playerState&&0!==e.playerState&&t.uint32(352).int64(e.playerState),void 0!==e.drcEnabled&&!1!==e.drcEnabled&&t.uint32(368).bool(e.drcEnabled),void 0!==e.field48&&0!==e.field48&&t.uint32(384).int32(e.field48),void 0!==e.field50&&0!==e.field50&&t.uint32(400).int32(e.field50),void 0!==e.field51&&0!==e.field51&&t.uint32(408).int32(e.field51),void 0!==e.sabrReportRequestCancellationInfo&&0!==e.sabrReportRequestCancellationInfo&&t.uint32(432).int32(e.sabrReportRequestCancellationInfo),void 0!==e.disableStreamingXhr&&!1!==e.disableStreamingXhr&&t.uint32(448).bool(e.disableStreamingXhr),void 0!==e.field57&&0!==e.field57&&t.uint32(456).int64(e.field57),void 0!==e.preferVp9&&!1!==e.preferVp9&&t.uint32(464).bool(e.preferVp9),void 0!==e.av1QualityThreshold&&0!==e.av1QualityThreshold&&t.uint32(472).int32(e.av1QualityThreshold),void 0!==e.field60&&0!==e.field60&&t.uint32(480).int32(e.field60),void 0!==e.isPrefetch&&!1!==e.isPrefetch&&t.uint32(488).bool(e.isPrefetch),void 0!==e.sabrSupportQualityConstraints&&!1!==e.sabrSupportQualityConstraints&&t.uint32(496).bool(e.sabrSupportQualityConstraints),void 0!==e.sabrLicenseConstraint&&0!==e.sabrLicenseConstraint.length&&t.uint32(506).bytes(e.sabrLicenseConstraint),void 0!==e.allowProximaLiveLatency&&0!==e.allowProximaLiveLatency&&t.uint32(512).int32(e.allowProximaLiveLatency),void 0!==e.sabrForceProxima&&0!==e.sabrForceProxima&&t.uint32(528).int32(e.sabrForceProxima),void 0!==e.field67&&0!==e.field67&&t.uint32(536).int32(e.field67),void 0!==e.sabrForceMaxNetworkInterruptionDurationMs&&0!==e.sabrForceMaxNetworkInterruptionDurationMs&&t.uint32(544).int64(e.sabrForceMaxNetworkInterruptionDurationMs),void 0!==e.audioTrackId&&""!==e.audioTrackId&&t.uint32(554).string(e.audioTrackId),void 0!==e.enableVoiceBoost&&!1!==e.enableVoiceBoost&&t.uint32(608).bool(e.enableVoiceBoost),void 0!==e.playbackAuthorization&&se.encode(e.playbackAuthorization,t.uint32(634).fork()).join(),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a=Ne();for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 13:if(104!==e)break;a.timeSinceLastManualFormatSelectionMs=Ue(i.int64());continue;case 14:if(112!==e)break;a.lastManualDirection=i.sint32();continue;case 16:if(128!==e)break;a.lastManualSelectedResolution=i.int32();continue;case 17:if(136!==e)break;a.detailedNetworkType=i.int32();continue;case 18:if(144!==e)break;a.clientViewportWidth=i.int32();continue;case 19:if(152!==e)break;a.clientViewportHeight=i.int32();continue;case 20:if(160!==e)break;a.clientBitrateCapBytesPerSec=Ue(i.int64());continue;case 21:if(168!==e)break;a.stickyResolution=i.int32();continue;case 22:if(176!==e)break;a.clientViewportIsFlexible=i.bool();continue;case 23:if(184!==e)break;a.bandwidthEstimate=Ue(i.int64());continue;case 24:if(192!==e)break;a.minAudioQuality=i.int32();continue;case 25:if(200!==e)break;a.maxAudioQuality=i.int32();continue;case 26:if(208!==e)break;a.videoQualitySetting=i.int32();continue;case 27:if(216!==e)break;a.audioRoute=i.int32();continue;case 28:if(224!==e)break;a.playerTimeMs=Ue(i.int64());continue;case 29:if(232!==e)break;a.timeSinceLastSeek=Ue(i.int64());continue;case 30:if(240!==e)break;a.dataSaverMode=i.bool();continue;case 32:if(256!==e)break;a.networkMeteredState=i.int32();continue;case 34:if(272!==e)break;a.visibility=i.int32();continue;case 35:if(285!==e)break;a.playbackRate=i.float();continue;case 36:if(288!==e)break;a.elapsedWallTimeMs=Ue(i.int64());continue;case 38:if(306!==e)break;a.mediaCapabilities=Ce.decode(i,i.uint32());continue;case 39:if(312!==e)break;a.timeSinceLastActionMs=Ue(i.int64());continue;case 40:if(320!==e)break;a.enabledTrackTypesBitfield=i.int32();continue;case 43:if(344!==e)break;a.maxPacingRate=i.int32();continue;case 44:if(352!==e)break;a.playerState=Ue(i.int64());continue;case 46:if(368!==e)break;a.drcEnabled=i.bool();continue;case 48:if(384!==e)break;a.field48=i.int32();continue;case 50:if(400!==e)break;a.field50=i.int32();continue;case 51:if(408!==e)break;a.field51=i.int32();continue;case 54:if(432!==e)break;a.sabrReportRequestCancellationInfo=i.int32();continue;case 56:if(448!==e)break;a.disableStreamingXhr=i.bool();continue;case 57:if(456!==e)break;a.field57=Ue(i.int64());continue;case 58:if(464!==e)break;a.preferVp9=i.bool();continue;case 59:if(472!==e)break;a.av1QualityThreshold=i.int32();continue;case 60:if(480!==e)break;a.field60=i.int32();continue;case 61:if(488!==e)break;a.isPrefetch=i.bool();continue;case 62:if(496!==e)break;a.sabrSupportQualityConstraints=i.bool();continue;case 63:if(506!==e)break;a.sabrLicenseConstraint=i.bytes();continue;case 64:if(512!==e)break;a.allowProximaLiveLatency=i.int32();continue;case 66:if(528!==e)break;a.sabrForceProxima=i.int32();continue;case 67:if(536!==e)break;a.field67=i.int32();continue;case 68:if(544!==e)break;a.sabrForceMaxNetworkInterruptionDurationMs=Ue(i.int64());continue;case 69:if(554!==e)break;a.audioTrackId=i.string();continue;case 76:if(608!==e)break;a.enableVoiceBoost=i.bool();continue;case 79:if(634!==e)break;a.playbackAuthorization=se.decode(i,i.uint32());continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function Ue(e){const t=globalThis.Number(e.toString());if(t>globalThis.Number.MAX_SAFE_INTEGER)throw new globalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");if(t<globalThis.Number.MIN_SAFE_INTEGER)throw new globalThis.Error("Value is smaller than Number.MIN_SAFE_INTEGER");return t}function Le(){return{clientInfo:void 0,poToken:new Uint8Array(0),playbackCookie:new Uint8Array(0),field4:new Uint8Array(0),sabrContexts:[],unsentSabrContexts:[],field7:"",field8:void 0}}t(Ue,"longToNumber"),t(Le,"createBaseStreamerContext");var Ve={encode(e,t=new W){void 0!==e.clientInfo&&qe.encode(e.clientInfo,t.uint32(10).fork()).join(),void 0!==e.poToken&&0!==e.poToken.length&&t.uint32(18).bytes(e.poToken),void 0!==e.playbackCookie&&0!==e.playbackCookie.length&&t.uint32(26).bytes(e.playbackCookie),void 0!==e.field4&&0!==e.field4.length&&t.uint32(34).bytes(e.field4);for(const i of e.sabrContexts)je.encode(i,t.uint32(42).fork()).join();t.uint32(50).fork();for(const i of e.unsentSabrContexts)t.int32(i);return t.join(),void 0!==e.field7&&""!==e.field7&&t.uint32(58).string(e.field7),void 0!==e.field8&&Ge.encode(e.field8,t.uint32(66).fork()).join(),t},decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a=Le();for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.clientInfo=qe.decode(i,i.uint32());continue;case 2:if(18!==e)break;a.poToken=i.bytes();continue;case 3:if(26!==e)break;a.playbackCookie=i.bytes();continue;case 4:if(34!==e)break;a.field4=i.bytes();continue;case 5:if(42!==e)break;a.sabrContexts.push(je.decode(i,i.uint32()));continue;case 6:if(48===e){a.unsentSabrContexts.push(i.int32());continue}if(50===e){const e=i.uint32()+i.pos;for(;i.pos<e;)a.unsentSabrContexts.push(i.int32());continue}break;case 7:if(58!==e)break;a.field7=i.string();continue;case 8:if(66!==e)break;a.field8=Ge.decode(i,i.uint32());continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function De(){return{deviceMake:"",deviceModel:"",clientName:0,clientVersion:"",osName:"",osVersion:"",acceptLanguage:"",acceptRegion:"",screenWidthPoints:0,screenHeightPoints:0,screenWidthInches:0,screenHeightInches:0,screenPixelDensity:0,clientFormFactor:0,gmscoreVersionCode:0,windowWidthPoints:0,windowHeightPoints:0,androidSdkVersion:0,screenDensityFloat:0,utcOffsetMinutes:0,timeZone:"",chipset:"",glDeviceInfo:void 0}}t(De,"createBaseStreamerContext_ClientInfo");var qe={encode:(e,t=new W)=>(void 0!==e.deviceMake&&""!==e.deviceMake&&t.uint32(98).string(e.deviceMake),void 0!==e.deviceModel&&""!==e.deviceModel&&t.uint32(106).string(e.deviceModel),void 0!==e.clientName&&0!==e.clientName&&t.uint32(128).int32(e.clientName),void 0!==e.clientVersion&&""!==e.clientVersion&&t.uint32(138).string(e.clientVersion),void 0!==e.osName&&""!==e.osName&&t.uint32(146).string(e.osName),void 0!==e.osVersion&&""!==e.osVersion&&t.uint32(154).string(e.osVersion),void 0!==e.acceptLanguage&&""!==e.acceptLanguage&&t.uint32(170).string(e.acceptLanguage),void 0!==e.acceptRegion&&""!==e.acceptRegion&&t.uint32(178).string(e.acceptRegion),void 0!==e.screenWidthPoints&&0!==e.screenWidthPoints&&t.uint32(296).int32(e.screenWidthPoints),void 0!==e.screenHeightPoints&&0!==e.screenHeightPoints&&t.uint32(304).int32(e.screenHeightPoints),void 0!==e.screenWidthInches&&0!==e.screenWidthInches&&t.uint32(317).float(e.screenWidthInches),void 0!==e.screenHeightInches&&0!==e.screenHeightInches&&t.uint32(325).float(e.screenHeightInches),void 0!==e.screenPixelDensity&&0!==e.screenPixelDensity&&t.uint32(328).int32(e.screenPixelDensity),void 0!==e.clientFormFactor&&0!==e.clientFormFactor&&t.uint32(368).int32(e.clientFormFactor),void 0!==e.gmscoreVersionCode&&0!==e.gmscoreVersionCode&&t.uint32(400).int32(e.gmscoreVersionCode),void 0!==e.windowWidthPoints&&0!==e.windowWidthPoints&&t.uint32(440).int32(e.windowWidthPoints),void 0!==e.windowHeightPoints&&0!==e.windowHeightPoints&&t.uint32(448).int32(e.windowHeightPoints),void 0!==e.androidSdkVersion&&0!==e.androidSdkVersion&&t.uint32(512).int32(e.androidSdkVersion),void 0!==e.screenDensityFloat&&0!==e.screenDensityFloat&&t.uint32(525).float(e.screenDensityFloat),void 0!==e.utcOffsetMinutes&&0!==e.utcOffsetMinutes&&t.uint32(536).int64(e.utcOffsetMinutes),void 0!==e.timeZone&&""!==e.timeZone&&t.uint32(642).string(e.timeZone),void 0!==e.chipset&&""!==e.chipset&&t.uint32(738).string(e.chipset),void 0!==e.glDeviceInfo&&Oe.encode(e.glDeviceInfo,t.uint32(818).fork()).join(),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={deviceMake:"",deviceModel:"",clientName:0,clientVersion:"",osName:"",osVersion:"",acceptLanguage:"",acceptRegion:"",screenWidthPoints:0,screenHeightPoints:0,screenWidthInches:0,screenHeightInches:0,screenPixelDensity:0,clientFormFactor:0,gmscoreVersionCode:0,windowWidthPoints:0,windowHeightPoints:0,androidSdkVersion:0,screenDensityFloat:0,utcOffsetMinutes:0,timeZone:"",chipset:"",glDeviceInfo:void 0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 12:if(98!==e)break;a.deviceMake=i.string();continue;case 13:if(106!==e)break;a.deviceModel=i.string();continue;case 16:if(128!==e)break;a.clientName=i.int32();continue;case 17:if(138!==e)break;a.clientVersion=i.string();continue;case 18:if(146!==e)break;a.osName=i.string();continue;case 19:if(154!==e)break;a.osVersion=i.string();continue;case 21:if(170!==e)break;a.acceptLanguage=i.string();continue;case 22:if(178!==e)break;a.acceptRegion=i.string();continue;case 37:if(296!==e)break;a.screenWidthPoints=i.int32();continue;case 38:if(304!==e)break;a.screenHeightPoints=i.int32();continue;case 39:if(317!==e)break;a.screenWidthInches=i.float();continue;case 40:if(325!==e)break;a.screenHeightInches=i.float();continue;case 41:if(328!==e)break;a.screenPixelDensity=i.int32();continue;case 46:if(368!==e)break;a.clientFormFactor=i.int32();continue;case 50:if(400!==e)break;a.gmscoreVersionCode=i.int32();continue;case 55:if(440!==e)break;a.windowWidthPoints=i.int32();continue;case 56:if(448!==e)break;a.windowHeightPoints=i.int32();continue;case 64:if(512!==e)break;a.androidSdkVersion=i.int32();continue;case 65:if(525!==e)break;a.screenDensityFloat=i.float();continue;case 67:if(536!==e)break;a.utcOffsetMinutes=Xe(i.int64());continue;case 80:if(642!==e)break;a.timeZone=i.string();continue;case 92:if(738!==e)break;a.chipset=i.string();continue;case 102:if(818!==e)break;a.glDeviceInfo=Oe.decode(i,i.uint32());continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function _e(){return{glRenderer:"",glEsVersionMajor:0,glEsVersionMinor:0}}t(_e,"createBaseStreamerContext_GLDeviceInfo");var Oe={encode:(e,t=new W)=>(void 0!==e.glRenderer&&""!==e.glRenderer&&t.uint32(10).string(e.glRenderer),void 0!==e.glEsVersionMajor&&0!==e.glEsVersionMajor&&t.uint32(16).int32(e.glEsVersionMajor),void 0!==e.glEsVersionMinor&&0!==e.glEsVersionMinor&&t.uint32(24).int32(e.glEsVersionMinor),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={glRenderer:"",glEsVersionMajor:0,glEsVersionMinor:0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.glRenderer=i.string();continue;case 2:if(16!==e)break;a.glEsVersionMajor=i.int32();continue;case 3:if(24!==e)break;a.glEsVersionMinor=i.int32();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function He(){return{type:0,value:new Uint8Array(0)}}t(He,"createBaseStreamerContext_SabrContext");var je={encode:(e,t=new W)=>(void 0!==e.type&&0!==e.type&&t.uint32(8).int32(e.type),void 0!==e.value&&0!==e.value.length&&t.uint32(18).bytes(e.value),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a=He();for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8!==e)break;a.type=i.int32();continue;case 2:if(18!==e)break;a.value=i.bytes();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function ze(){return{field1:new Uint8Array(0),field2:void 0}}t(ze,"createBaseStreamerContext_UnknownMessage1");var Ge={encode:(e,t=new W)=>(void 0!==e.field1&&0!==e.field1.length&&t.uint32(10).bytes(e.field1),void 0!==e.field2&&$e.encode(e.field2,t.uint32(18).fork()).join(),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a=ze();for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.field1=i.bytes();continue;case 2:if(18!==e)break;a.field2=$e.decode(i,i.uint32());continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function We(){return{code:0,message:""}}t(We,"createBaseStreamerContext_UnknownMessage1_UnknownInnerMessage1");var $e={encode:(e,t=new W)=>(void 0!==e.code&&0!==e.code&&t.uint32(8).int32(e.code),void 0!==e.message&&""!==e.message&&t.uint32(18).string(e.message),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={code:0,message:""};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8!==e)break;a.code=i.int32();continue;case 2:if(18!==e)break;a.message=i.string();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function Xe(e){const t=globalThis.Number(e.toString());if(t>globalThis.Number.MAX_SAFE_INTEGER)throw new globalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");if(t<globalThis.Number.MIN_SAFE_INTEGER)throw new globalThis.Error("Value is smaller than Number.MIN_SAFE_INTEGER");return t}function Qe(){return{clientAbrState:void 0,selectedFormatIds:[],bufferedRanges:[],playerTimeMs:0,videoPlaybackUstreamerConfig:new Uint8Array(0),field6:void 0,preferredAudioFormatIds:[],preferredVideoFormatIds:[],preferredSubtitleFormatIds:[],streamerContext:void 0,field21:void 0,field22:0,field23:0,field1000:[]}}t(Xe,"longToNumber"),t(Qe,"createBaseVideoPlaybackAbrRequest");var Ke={encode(e,t=new W){void 0!==e.clientAbrState&&Fe.encode(e.clientAbrState,t.uint32(10).fork()).join();for(const i of e.selectedFormatIds)J.encode(i,t.uint32(18).fork()).join();for(const i of e.bufferedRanges)pe.encode(i,t.uint32(26).fork()).join();void 0!==e.playerTimeMs&&0!==e.playerTimeMs&&t.uint32(32).int64(e.playerTimeMs),void 0!==e.videoPlaybackUstreamerConfig&&0!==e.videoPlaybackUstreamerConfig.length&&t.uint32(42).bytes(e.videoPlaybackUstreamerConfig),void 0!==e.field6&&Ye.encode(e.field6,t.uint32(50).fork()).join();for(const i of e.preferredAudioFormatIds)J.encode(i,t.uint32(130).fork()).join();for(const i of e.preferredVideoFormatIds)J.encode(i,t.uint32(138).fork()).join();for(const i of e.preferredSubtitleFormatIds)J.encode(i,t.uint32(146).fork()).join();void 0!==e.streamerContext&&Ve.encode(e.streamerContext,t.uint32(154).fork()).join(),void 0!==e.field21&&et.encode(e.field21,t.uint32(170).fork()).join(),void 0!==e.field22&&0!==e.field22&&t.uint32(176).int32(e.field22),void 0!==e.field23&&0!==e.field23&&t.uint32(184).int32(e.field23);for(const i of e.field1000)it.encode(i,t.uint32(8002).fork()).join();return t},decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a=Qe();for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.clientAbrState=Fe.decode(i,i.uint32());continue;case 2:if(18!==e)break;a.selectedFormatIds.push(J.decode(i,i.uint32()));continue;case 3:if(26!==e)break;a.bufferedRanges.push(pe.decode(i,i.uint32()));continue;case 4:if(32!==e)break;a.playerTimeMs=nt(i.int64());continue;case 5:if(42!==e)break;a.videoPlaybackUstreamerConfig=i.bytes();continue;case 6:if(50!==e)break;a.field6=Ye.decode(i,i.uint32());continue;case 16:if(130!==e)break;a.preferredAudioFormatIds.push(J.decode(i,i.uint32()));continue;case 17:if(138!==e)break;a.preferredVideoFormatIds.push(J.decode(i,i.uint32()));continue;case 18:if(146!==e)break;a.preferredSubtitleFormatIds.push(J.decode(i,i.uint32()));continue;case 19:if(154!==e)break;a.streamerContext=Ve.decode(i,i.uint32());continue;case 21:if(170!==e)break;a.field21=et.decode(i,i.uint32());continue;case 22:if(176!==e)break;a.field22=i.int32();continue;case 23:if(184!==e)break;a.field23=i.int32();continue;case 1e3:if(8002!==e)break;a.field1000.push(it.decode(i,i.uint32()));continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function Ze(){return{formatId:void 0,lmt:0,sequenceNumber:0,timeRange:void 0,field5:0}}t(Ze,"createBaseUnknownMessage1");var Ye={encode:(e,t=new W)=>(void 0!==e.formatId&&J.encode(e.formatId,t.uint32(10).fork()).join(),void 0!==e.lmt&&0!==e.lmt&&t.uint32(16).sint64(e.lmt),void 0!==e.sequenceNumber&&0!==e.sequenceNumber&&t.uint32(24).int32(e.sequenceNumber),void 0!==e.timeRange&&le.encode(e.timeRange,t.uint32(34).fork()).join(),void 0!==e.field5&&0!==e.field5&&t.uint32(40).int32(e.field5),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={formatId:void 0,lmt:0,sequenceNumber:0,timeRange:void 0,field5:0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.formatId=J.decode(i,i.uint32());continue;case 2:if(16!==e)break;a.lmt=nt(i.sint64());continue;case 3:if(24!==e)break;a.sequenceNumber=i.int32();continue;case 4:if(34!==e)break;a.timeRange=le.decode(i,i.uint32());continue;case 5:if(40!==e)break;a.field5=i.int32();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function Je(){return{field1:[],field2:new Uint8Array(0),field3:"",field4:0,field5:0,field6:""}}t(Je,"createBaseUnknownMessage2");var et={encode(e,t=new W){for(const i of e.field1)t.uint32(10).string(i);return void 0!==e.field2&&0!==e.field2.length&&t.uint32(18).bytes(e.field2),void 0!==e.field3&&""!==e.field3&&t.uint32(26).string(e.field3),void 0!==e.field4&&0!==e.field4&&t.uint32(32).int32(e.field4),void 0!==e.field5&&0!==e.field5&&t.uint32(40).int32(e.field5),void 0!==e.field6&&""!==e.field6&&t.uint32(50).string(e.field6),t},decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a=Je();for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.field1.push(i.string());continue;case 2:if(18!==e)break;a.field2=i.bytes();continue;case 3:if(26!==e)break;a.field3=i.string();continue;case 4:if(32!==e)break;a.field4=i.int32();continue;case 5:if(40!==e)break;a.field5=i.int32();continue;case 6:if(50!==e)break;a.field6=i.string();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function tt(){return{formatIds:[],ud:[],clipId:""}}t(tt,"createBaseUnknownMessage3");var it={encode(e,t=new W){for(const i of e.formatIds)J.encode(i,t.uint32(10).fork()).join();for(const i of e.ud)pe.encode(i,t.uint32(18).fork()).join();return void 0!==e.clipId&&""!==e.clipId&&t.uint32(26).string(e.clipId),t},decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={formatIds:[],ud:[],clipId:""};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.formatIds.push(J.decode(i,i.uint32()));continue;case 2:if(18!==e)break;a.ud.push(pe.decode(i,i.uint32()));continue;case 3:if(26!==e)break;a.clipId=i.string();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function nt(e){const t=globalThis.Number(e.toString());if(t>globalThis.Number.MAX_SAFE_INTEGER)throw new globalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");if(t<globalThis.Number.MIN_SAFE_INTEGER)throw new globalThis.Error("Value is smaller than Number.MIN_SAFE_INTEGER");return t}function at(){return{targetAudioReadaheadMs:0,targetVideoReadaheadMs:0,maxTimeSinceLastRequestMs:0,backoffTimeMs:0,minAudioReadaheadMs:0,minVideoReadaheadMs:0,playbackCookie:void 0,videoId:""}}t(nt,"longToNumber"),t(at,"createBaseNextRequestPolicy");var st={encode:(e,t=new W)=>(void 0!==e.targetAudioReadaheadMs&&0!==e.targetAudioReadaheadMs&&t.uint32(8).int32(e.targetAudioReadaheadMs),void 0!==e.targetVideoReadaheadMs&&0!==e.targetVideoReadaheadMs&&t.uint32(16).int32(e.targetVideoReadaheadMs),void 0!==e.maxTimeSinceLastRequestMs&&0!==e.maxTimeSinceLastRequestMs&&t.uint32(24).int32(e.maxTimeSinceLastRequestMs),void 0!==e.backoffTimeMs&&0!==e.backoffTimeMs&&t.uint32(32).int32(e.backoffTimeMs),void 0!==e.minAudioReadaheadMs&&0!==e.minAudioReadaheadMs&&t.uint32(40).int32(e.minAudioReadaheadMs),void 0!==e.minVideoReadaheadMs&&0!==e.minVideoReadaheadMs&&t.uint32(48).int32(e.minVideoReadaheadMs),void 0!==e.playbackCookie&&Ae.encode(e.playbackCookie,t.uint32(58).fork()).join(),void 0!==e.videoId&&""!==e.videoId&&t.uint32(66).string(e.videoId),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={targetAudioReadaheadMs:0,targetVideoReadaheadMs:0,maxTimeSinceLastRequestMs:0,backoffTimeMs:0,minAudioReadaheadMs:0,minVideoReadaheadMs:0,playbackCookie:void 0,videoId:""};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8!==e)break;a.targetAudioReadaheadMs=i.int32();continue;case 2:if(16!==e)break;a.targetVideoReadaheadMs=i.int32();continue;case 3:if(24!==e)break;a.maxTimeSinceLastRequestMs=i.int32();continue;case 4:if(32!==e)break;a.backoffTimeMs=i.int32();continue;case 5:if(40!==e)break;a.minAudioReadaheadMs=i.int32();continue;case 6:if(48!==e)break;a.minVideoReadaheadMs=i.int32();continue;case 7:if(58!==e)break;a.playbackCookie=Ae.decode(i,i.uint32());continue;case 8:if(66!==e)break;a.videoId=i.string();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function rt(){return{type:"",code:0}}t(rt,"createBaseSabrError");var ot={encode:(e,t=new W)=>(void 0!==e.type&&""!==e.type&&t.uint32(10).string(e.type),void 0!==e.code&&0!==e.code&&t.uint32(16).int32(e.code),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={type:"",code:0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.type=i.string();continue;case 2:if(16!==e)break;a.code=i.int32();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function ct(){return{url:""}}t(ct,"createBaseSabrRedirect");var dt={encode:(e,t=new W)=>(void 0!==e.url&&""!==e.url&&t.uint32(10).string(e.url),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={url:""};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.url=i.string();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function ut(){return{token:""}}t(ut,"createBaseReloadPlaybackParams");var lt={encode:(e,t=new W)=>(void 0!==e.token&&""!==e.token&&t.uint32(10).string(e.token),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={token:""};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.token=i.string();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function ft(){return{reloadPlaybackParams:void 0}}t(ft,"createBaseReloadPlaybackContext");var ht={encode:(e,t=new W)=>(void 0!==e.reloadPlaybackParams&&lt.encode(e.reloadPlaybackParams,t.uint32(10).fork()).join(),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={reloadPlaybackParams:void 0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(10!==e)break;a.reloadPlaybackParams=lt.decode(i,i.uint32());continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}},bt={UNSPECIFIED:0,0:"UNSPECIFIED",OVERWRITE:1,1:"OVERWRITE",KEEP_EXISTING:2,2:"KEEP_EXISTING",UNRECOGNIZED:-1,"-1":"UNRECOGNIZED"};function mt(){return{type:0,scope:0,value:new Uint8Array(0),sendByDefault:!1,writePolicy:0}}t(mt,"createBaseSabrContextUpdate");var gt={encode:(e,t=new W)=>(void 0!==e.type&&0!==e.type&&t.uint32(8).int32(e.type),void 0!==e.scope&&0!==e.scope&&t.uint32(16).int32(e.scope),void 0!==e.value&&0!==e.value.length&&t.uint32(26).bytes(e.value),void 0!==e.sendByDefault&&!1!==e.sendByDefault&&t.uint32(32).bool(e.sendByDefault),void 0!==e.writePolicy&&0!==e.writePolicy&&t.uint32(40).int32(e.writePolicy),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a=mt();for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8!==e)break;a.type=i.int32();continue;case 2:if(16!==e)break;a.scope=i.int32();continue;case 3:if(26!==e)break;a.value=i.bytes();continue;case 4:if(32!==e)break;a.sendByDefault=i.bool();continue;case 5:if(40!==e)break;a.writePolicy=i.int32();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function pt(){return{startPolicy:[],stopPolicy:[],discardPolicy:[]}}t(pt,"createBaseSabrContextSendingPolicy");var kt={encode(e,t=new W){t.uint32(10).fork();for(const i of e.startPolicy)t.int32(i);t.join(),t.uint32(18).fork();for(const i of e.stopPolicy)t.int32(i);t.join(),t.uint32(26).fork();for(const i of e.discardPolicy)t.int32(i);return t.join(),t},decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={startPolicy:[],stopPolicy:[],discardPolicy:[]};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8===e){a.startPolicy.push(i.int32());continue}if(10===e){const e=i.uint32()+i.pos;for(;i.pos<e;)a.startPolicy.push(i.int32());continue}break;case 2:if(16===e){a.stopPolicy.push(i.int32());continue}if(18===e){const e=i.uint32()+i.pos;for(;i.pos<e;)a.stopPolicy.push(i.int32());continue}break;case 3:if(24===e){a.discardPolicy.push(i.int32());continue}if(26===e){const e=i.uint32()+i.pos;for(;i.pos<e;)a.discardPolicy.push(i.int32());continue}}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function vt(){return{status:0,maxRetries:0}}t(vt,"createBaseStreamProtectionStatus");var yt={encode:(e,t=new W)=>(void 0!==e.status&&0!==e.status&&t.uint32(8).int32(e.status),void 0!==e.maxRetries&&0!==e.maxRetries&&t.uint32(16).int32(e.maxRetries),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={status:0,maxRetries:0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8!==e)break;a.status=i.int32();continue;case 2:if(16!==e)break;a.maxRetries=i.int32();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}};function wt(){return{id:0}}t(wt,"createBaseSnackbarMessage");var Mt={encode:(e,t=new W)=>(void 0!==e.id&&0!==e.id&&t.uint32(8).int32(e.id),t),decode(e,t){const i=e instanceof X?e:new X(e),n=void 0===t?i.len:i.pos+t,a={id:0};for(;i.pos<n;){const e=i.uint32();switch(e>>>3){case 1:if(8!==e)break;a.id=i.int32();continue}if(4==(7&e)||0===e)break;i.skip(7&e)}return a}},St=20,It=21,Rt=22,Ct=35,Tt=42,Et=43,xt=44,Bt=46,Pt=57,At=58,Nt=59,Ft=67,Ut="SabrStreamingAdapter",Lt={PROTOCOL:"sabr:",KEY_PARAM:"key",DEFAULT_OPTIONS:{enableCaching:!0,enableVerboseRequestLogging:!1,maxCacheSizeMB:3,maxCacheAgeSeconds:300}},Vt=new Uint8Array([120,0]),Dt=class{onSnackbarMessage(e){this.onSnackbarMessageCallback=e}onReloadPlayerResponse(e){this.onReloadPlayerResponseCallback=e}onMintPoToken(e){this.onMintPoTokenCallback=e}constructor(e){if(this.initializedFormats=new Map,this.logger=p.getInstance(),this.sabrFormats=[],this.sabrContexts=new Map,this.activeSabrContextTypes=new Set,this.cacheManager=null,this.requestNumber=0,this.activeDelayPromise=null,this.isDisposed=!1,this.options={...Lt.DEFAULT_OPTIONS,...e},!e.playerAdapter)throw new M("A player adapter is required.");this.playerAdapter=e.playerAdapter,this.options.enableCaching&&(this.cacheManager=new y(this.options.maxCacheSizeMB,this.options.maxCacheAgeSeconds)),this.requestMetadataManager=new I}attach(e){this.checkDisposed(),this.playerAdapter.initialize(e,this.requestMetadataManager,this.cacheManager),this.setupInterceptors()}setStreamingURL(e){this.checkDisposed(),this.serverAbrStreamingUrl=e}setUstreamerConfig(e){this.checkDisposed(),this.ustreamerConfig=e}setServerAbrFormats(e){this.checkDisposed(),this.sabrFormats=e}getCacheManager(){return this.cacheManager}setupInterceptors(){this.playerAdapter.registerRequestInterceptor(this.handleRequest.bind(this)),this.playerAdapter.registerResponseInterceptor(this.handleResponse.bind(this))}async handleRequest(e){var t,i;const n=new URL(e.url);if(n.protocol===Lt.PROTOCOL){if(this.activeDelayPromise&&await this.activeDelayPromise,!this.serverAbrStreamingUrl)throw new M("Server ABR URL not set.");if(!this.sabrFormats.length)throw new M("No SABR formats available.");const t=String(this.requestNumber++),i=new URL(this.serverAbrStreamingUrl||"");i.searchParams.set("rn",t),e.url=i.toString();const a=this.sabrFormats.find((e=>d(e)===(n.searchParams.get(Lt.KEY_PARAM)||"")));if(!a)throw new M(`Could not determine current format from URL: ${e.url}`);const r=this.playerAdapter.getActiveTrackFormats(a,this.sabrFormats),o=await this.createVideoPlaybackAbrRequest(e,a,r);a.height&&(o.clientAbrState.stickyResolution=a.height,o.clientAbrState.lastManualSelectedResolution=a.height);const c=this.addBufferingInfoToAbrRequest(o,a,r);c&&o.selectedFormatIds.push(c),e.segment.isInit()||o.selectedFormatIds.push(a),this.options.enableVerboseRequestLogging&&this.logger.debug(Ut,`Created VideoPlaybackAbrRequest (${t}):`,o),e.body=Ke.encode(o).finish(),this.requestMetadataManager.metadataMap.set(t,{format:a,isUMP:!0,isSABR:!0,isInit:e.segment.isInit(),byteRange:s(e.headers.Range),timestamp:Date.now()})}else{const a=this.onMintPoTokenCallback?await this.onMintPoTokenCallback():void 0;n.pathname.includes("videoplayback/expire")||n.pathname.includes("source/yt_live_broadcast")?(n.pathname+="/ump/1",n.pathname+="/srfvp/1",n.pathname+="/alr/yes",a&&(n.pathname+=`/pot/${a}`),e.headers.Range&&(n.pathname+=`/range/${null==(t=e.headers.Range)?void 0:t.split("=")[1]}`)):(n.searchParams.set("ump","1"),n.searchParams.set("srfvp","1"),n.searchParams.set("alr","yes"),a&&n.searchParams.set("pot",a),e.headers.Range&&n.searchParams.set("range",null==(i=e.headers.Range)?void 0:i.split("=")[1]));const s=String(this.requestNumber++);n.searchParams.set("rn",s),e.url=n.toString(),e.body=Vt,this.requestMetadataManager.metadataMap.set(s,{isUMP:!0,isSABR:!1,timestamp:Date.now()})}return e.method="POST",delete e.headers.Range,e}async createVideoPlaybackAbrRequest(e,t,i){var s,o;if(!this.ustreamerConfig)throw new M("Ustreamer config not set");const c={poToken:this.onMintPoTokenCallback?r(await this.onMintPoTokenCallback()):void 0,playbackCookie:this.lastPlaybackCookie?Ae.encode(this.lastPlaybackCookie).finish():void 0,clientInfo:this.options.clientInfo,sabrContexts:[],unsentSabrContexts:[]};for(const e of this.sabrContexts.values())this.activeSabrContextTypes.has(e.type)?c.sabrContexts.push(e):c.unsentSabrContexts.push(e.type);return{clientAbrState:{playbackRate:this.playerAdapter.getPlaybackRate(),playerTimeMs:Math.round(1e3*(null!=(s=e.segment.getStartTime())?s:this.playerAdapter.getPlayerTime())),timeSinceLastManualFormatSelectionMs:0,clientViewportIsFlexible:!1,bandwidthEstimate:Math.round(this.playerAdapter.getBandwidthEstimate()||0),drcEnabled:null!=(o=null==t?void 0:t.isDrc)&&o,enabledTrackTypesBitfield:t.width?a:n,audioTrackId:t.audioTrackId},bufferedRanges:[],selectedFormatIds:[],preferredAudioFormatIds:[i.audioFormat||{}],preferredVideoFormatIds:[i.videoFormat||{}],preferredSubtitleFormatIds:[],videoPlaybackUstreamerConfig:r(this.ustreamerConfig),streamerContext:c,field1000:[]}}addBufferingInfoToAbrRequest(e,t,i){var n;let a;const s=d(t);for(const t of Object.values(i)){if(!t)continue;const i=d(t),r=s!==i,o=this.initializedFormats.get(i||""),c=r?this.createFullBufferRange(t):this.createPartialBufferRange(o,null==(n=e.clientAbrState)?void 0:n.playerTimeMs);c&&(e.bufferedRanges.push(c),r&&(a=t))}return a}createFullBufferRange(e){return{formatId:e,durationMs:i,startTimeMs:0,startSegmentIndex:i,endSegmentIndex:i,timeRange:{durationTicks:i,startTicks:0,timescale:1e3}}}createPartialBufferRange(e,t){if(!(null==e?void 0:e.lastSegmentMetadata))return null;if(void 0!==t&&t<e.lastSegmentMetadata.startTimeMs)return null;const{formatId:i,startSequenceNumber:n,timescale:a,durationMs:s,endSequenceNumber:r}=e.lastSegmentMetadata;return{formatId:i,startSegmentIndex:n,durationMs:s,startTimeMs:0,endSegmentIndex:r,timeRange:{timescale:a,startTicks:0,durationTicks:s}}}async handleResponse(e){var i,n,a,s,r,o,c,l;const f=this.requestMetadataManager.getRequestMetadata(e.url,!0);if(!f)return e;const{streamInfo:h,format:b,byteRange:m,isSABR:g}=f;if(!h)return e;const p=t((async()=>{const t=(null==b?void 0:b.width)?"video":"audio",i=d(b)||"",n=new URL(`${Lt.PROTOCOL}//${t}?${Lt.KEY_PARAM}=${i}`);return await this.makeFollowupRequest(e,n.toString(),g,m)}),"retry");if(h.snackbarMessage&&(this.logger.debug(Ut,"Received snackbar message:",h.snackbarMessage),this.onSnackbarMessageCallback&&this.onSnackbarMessageCallback(h.snackbarMessage)),null==(i=h.redirect)?void 0:i.url){let t=new URL(null==(n=h.redirect)?void 0:n.url);if(this.logger.info(Ut,`Redirecting to ${t}`),g){this.serverAbrStreamingUrl=null==(a=h.redirect)?void 0:a.url;const e=(null==b?void 0:b.width)?"video":"audio",i=d(b)||"";t=new URL(`${Lt.PROTOCOL}//${e}?${Lt.KEY_PARAM}=${i}`)}if(!(null==(s=e.data)?void 0:s.byteLength))return await this.makeFollowupRequest(e,t.toString(),g,m)}if(h.nextRequestPolicy){this.lastPlaybackCookie=null==(r=h.nextRequestPolicy)?void 0:r.playbackCookie;const e=h.nextRequestPolicy.backoffTimeMs||0;e>0&&!this.activeDelayPromise&&(this.logger.info(Ut,`Delaying next requests by ${e/1e3} seconds.`),this.activeDelayPromise=new Promise((t=>{setTimeout((()=>{this.logger.info(Ut,"Delay completed, resuming requests."),this.activeDelayPromise=null,t()}),e)})))}if(h.sabrContextSendingPolicy){for(const e of h.sabrContextSendingPolicy.startPolicy)this.activeSabrContextTypes.has(e)||(this.activeSabrContextTypes.add(e),this.logger.debug(Ut,`Activated SABR context for type ${e}`));for(const e of h.sabrContextSendingPolicy.stopPolicy)this.activeSabrContextTypes.has(e)&&(this.activeSabrContextTypes.delete(e),this.logger.debug(Ut,`Deactivated SABR context for type ${e}`));for(const e of h.sabrContextSendingPolicy.discardPolicy)this.sabrContexts.has(e)&&(this.sabrContexts.delete(e),this.logger.debug(Ut,`Discarded SABR context for type ${e}`))}if(h.sabrContextUpdate&&void 0!==h.sabrContextUpdate.type&&(null==(o=h.sabrContextUpdate.value)?void 0:o.length)&&(this.sabrContexts.has(h.sabrContextUpdate.type)&&h.sabrContextUpdate.writePolicy!==bt.OVERWRITE||(this.logger.debug(Ut,`Received SABR context update (type: ${h.sabrContextUpdate.type}, writePolicy: ${bt[h.sabrContextUpdate.writePolicy]} sendByDefault: ${h.sabrContextUpdate.sendByDefault})`),this.sabrContexts.set(h.sabrContextUpdate.type,h.sabrContextUpdate)),h.sabrContextUpdate.sendByDefault&&this.activeSabrContextTypes.add(h.sabrContextUpdate.type),!(null==(c=e.data)?void 0:c.byteLength)))return p();if(h.reloadPlaybackContext&&this.onReloadPlayerResponseCallback)return this.logger.info(Ut,"Server requested player reload with new parameters:",h.reloadPlaybackContext),await this.onReloadPlayerResponseCallback(h.reloadPlaybackContext),p();if(h.mediaHeader){const e=u(h.mediaHeader);if(h.mediaHeader.isInitSeg)return;const t=this.initializedFormats.get(e)||{};t.lastSegmentMetadata={formatId:h.mediaHeader.formatId,startSequenceNumber:h.mediaHeader.sequenceNumber||1,endSequenceNumber:h.mediaHeader.sequenceNumber||1,startTimeMs:h.mediaHeader.startMs||0,durationMs:h.mediaHeader.durationMs||0,timescale:(null==(l=h.mediaHeader.timeRange)?void 0:l.timescale)||1e3},this.initializedFormats.set(e,t)}return e}async makeFollowupRequest(e,t,i,n){this.activeDelayPromise&&await this.activeDelayPromise;const a={};i&&n&&(a.Range=`bytes=${n.start}-${n.end}`);const s=await e.makeRequest(t,a);return Object.assign(e,s),e}checkDisposed(){if(this.isDisposed)throw new M("Adapter has been disposed.")}dispose(){var e;this.isDisposed||(null==(e=this.cacheManager)||e.dispose(),this.cacheManager=null,this.initializedFormats.clear(),this.requestMetadataManager.metadataMap.clear(),this.sabrContexts.clear(),this.activeSabrContextTypes.clear(),this.lastPlaybackCookie=void 0,this.sabrFormats=[],this.serverAbrStreamingUrl=void 0,this.ustreamerConfig=void 0,this.activeDelayPromise=null,this.playerAdapter.dispose(),this.requestNumber=0,this.onReloadPlayerResponseCallback=void 0,this.onSnackbarMessageCallback=void 0,this.onMintPoTokenCallback=void 0,this.options=void 0,this.isDisposed=!0,this.logger.debug(Ut,"Disposed"))}};t(Dt,"SabrStreamingAdapter");var qt=Dt,_t=class e{constructor(e=[]){this.chunks=[],this.currentChunkOffset=this.currentChunkIndex=0,this.currentDataView=void 0,this.totalLength=0,e.forEach((e=>this.append(e)))}append(e){if(e instanceof Uint8Array){if(this.canMergeWithLastChunk(e)){const t=this.chunks[this.chunks.length-1];this.chunks[this.chunks.length-1]=new Uint8Array(t.buffer,t.byteOffset,t.length+e.length),this.resetFocus()}else this.chunks.push(e);this.totalLength+=e.length}else e.chunks.forEach((e=>this.append(e)))}split(t){const i=new e,n=new e,a=this.chunks[Symbol.iterator]();let s=a.next();for(;!s.done;){const e=s.value;t>=e.length?(i.append(e),t-=e.length):t>0?(i.append(new Uint8Array(e.buffer,e.byteOffset,t)),n.append(new Uint8Array(e.buffer,e.byteOffset+t,e.length-t)),t=0):n.append(e),s=a.next()}return{extractedBuffer:i,remainingBuffer:n}}getLength(){return this.totalLength}canReadBytes(e,t){return e+t<=this.totalLength}getUint8(e){return this.focus(e),this.chunks[this.currentChunkIndex][e-this.currentChunkOffset]}focus(e){if(!this.isFocused(e)){for(e<this.currentChunkOffset&&this.resetFocus();this.currentChunkOffset+this.chunks[this.currentChunkIndex].length<=e&&this.currentChunkIndex<this.chunks.length-1;)this.currentChunkOffset+=this.chunks[this.currentChunkIndex].length,this.currentChunkIndex+=1;this.currentDataView=void 0}}isFocused(e){return e>=this.currentChunkOffset&&e<this.currentChunkOffset+this.chunks[this.currentChunkIndex].length}resetFocus(){this.currentDataView=void 0,this.currentChunkIndex=0,this.currentChunkOffset=0}canMergeWithLastChunk(e){if(0===this.chunks.length)return!1;const t=this.chunks[this.chunks.length-1];return t.buffer===e.buffer&&t.byteOffset+t.length===e.byteOffset}};t(_t,"CompositeBuffer");var Ot=_t,Ht=class{constructor(e){this.compositeBuffer=e}read(e){for(;;){let t=0;const[i,n]=this.readVarInt(t);t=n;const[a,s]=this.readVarInt(t);if(t=s,i<0||a<0)break;if(!this.compositeBuffer.canReadBytes(t,a)){if(!this.compositeBuffer.canReadBytes(t,1))break;return{type:i,size:a,data:this.compositeBuffer}}const r=this.compositeBuffer.split(t).remainingBuffer.split(a);t=0,e({type:i,size:a,data:r.extractedBuffer}),this.compositeBuffer=r.remainingBuffer}}readVarInt(e){let t,i;if(this.compositeBuffer.canReadBytes(e,1)){const i=this.compositeBuffer.getUint8(e);t=i<128?1:i<192?2:i<224?3:i<240?4:5}else t=0;if(t<1||!this.compositeBuffer.canReadBytes(e,t))return[-1,e];switch(t){case 1:i=this.compositeBuffer.getUint8(e++);break;case 2:i=(63&this.compositeBuffer.getUint8(e++))+64*this.compositeBuffer.getUint8(e++);break;case 3:i=(31&this.compositeBuffer.getUint8(e++))+32*(this.compositeBuffer.getUint8(e++)+256*this.compositeBuffer.getUint8(e++));break;case 4:i=(15&this.compositeBuffer.getUint8(e++))+16*(this.compositeBuffer.getUint8(e++)+256*(this.compositeBuffer.getUint8(e++)+256*this.compositeBuffer.getUint8(e++)));break;default:{const t=e+1;if(this.compositeBuffer.focus(t),this.canReadFromCurrentChunk(t,4))i=this.getCurrentDataView().getUint32(t-this.compositeBuffer.currentChunkOffset,!0);else{const e=this.compositeBuffer.getUint8(t+2)+256*this.compositeBuffer.getUint8(t+3);i=this.compositeBuffer.getUint8(t)+256*(this.compositeBuffer.getUint8(t+1)+256*e)}e+=5;break}}return[i,e]}canReadFromCurrentChunk(e,t){return e-this.compositeBuffer.currentChunkOffset+t<=this.compositeBuffer.chunks[this.compositeBuffer.currentChunkIndex].length}getCurrentDataView(){if(!this.compositeBuffer.currentDataView){const e=this.compositeBuffer.chunks[this.compositeBuffer.currentChunkIndex];this.compositeBuffer.currentDataView=new DataView(e.buffer,e.byteOffset,e.length)}return this.compositeBuffer.currentDataView}};t(Ht,"UmpReader");var jt=Ht,zt=class{constructor(e,t){this.requestMetadata=e,this.cacheManager=t,this.formatInitMetadata=[],this.partialSegments=new Map,this.umpPartHandlers=new Map([[Tt,this.handleFormatInitMetadata.bind(this)],[Ct,this.handleNextRequestPolicy.bind(this)],[xt,this.handleSabrError.bind(this)],[Et,this.handleSabrRedirect.bind(this)],[Pt,this.handleSabrContextUpdate.bind(this)],[Nt,this.handleSabrContextSendingPolicy.bind(this)],[Ft,this.handleSnackbarMessage.bind(this)],[At,this.handleStreamProtectionStatus.bind(this)],[Bt,this.handleReloadPlayerResponse.bind(this)],[St,this.handleMediaHeader.bind(this)],[It,this.handleMedia.bind(this)],[Rt,this.handleMediaEnd.bind(this)]])}processChunk(e){return new Promise((t=>{let i;this.partialPart?(i=this.partialPart.data,i.append(e)):i=new Ot([e]);const n=new jt(i);this.partialPart=n.read((e=>{const i=this.umpPartHandlers.get(e.type),n=null==i?void 0:i(e);n&&(this.partialPart=void 0,this.desiredHeaderId=void 0,this.partialSegments.clear(),t(n))})),t(void 0)}))}getSegmentInfo(){return this.partialSegments.get(this.desiredHeaderId||0)}decodePart(e,t){if(e.data.chunks.length)try{return t.decode(o(e.data.chunks))}catch{return}}handleFormatInitMetadata(e){const t=this.decodePart(e,ce);t&&this.formatInitMetadata.push(t)}handleNextRequestPolicy(e){const t=this.decodePart(e,st);t&&(this.requestMetadata.streamInfo={...this.requestMetadata.streamInfo,nextRequestPolicy:t})}handleMediaHeader(e){const t=this.decodePart(e,be);if(!t)return;const i=d(this.requestMetadata.format),n=u(t);if(!this.requestMetadata.isSABR||n===i){const e={headerId:t.headerId,mediaHeader:t,bufferedChunks:[],lastChunkSize:0};void 0===this.desiredHeaderId&&(this.desiredHeaderId=t.headerId),this.partialSegments.set(t.headerId,e)}}handleMedia(e){const t=e.data.getUint8(0),i=e.data.split(1).remainingBuffer,n=this.partialSegments.get(t);if(n){n.lastChunkSize=i.getLength();for(const e of i.chunks)n.bufferedChunks.push(e)}}handleMediaEnd(e){const t=e.data.getUint8(0),i=this.partialSegments.get(t);if(i&&i.headerId===this.desiredHeaderId){const e=o(i.bufferedChunks);return this.requestMetadata.streamInfo={...this.requestMetadata.streamInfo,formatInitMetadata:this.formatInitMetadata,mediaHeader:i.mediaHeader},this.requestMetadata.isInit&&this.requestMetadata.byteRange&&this.requestMetadata.format?(this.cacheManager&&this.cacheManager.setInitSegment(f(i.mediaHeader,this.requestMetadata.format),e),{data:e.slice(this.requestMetadata.byteRange.start,this.requestMetadata.byteRange.end+1),done:!0}):{data:e,done:!0}}}handleSnackbarMessage(e){const t=this.decodePart(e,Mt);t&&(this.requestMetadata.streamInfo={...this.requestMetadata.streamInfo,snackbarMessage:t})}handleSabrError(e){const t=this.decodePart(e,ot);return this.requestMetadata.error={sabrError:t},{done:!0}}handleStreamProtectionStatus(e){const t=this.decodePart(e,yt);if(t)return this.requestMetadata.streamInfo={...this.requestMetadata.streamInfo,streamProtectionStatus:t},3===t.status?{done:!0}:void 0}handleReloadPlayerResponse(e){const t=this.decodePart(e,ht);if(t)return this.requestMetadata.streamInfo={...this.requestMetadata.streamInfo,reloadPlaybackContext:t},{done:!0}}handleSabrRedirect(e){const t=this.decodePart(e,dt);if(t)return this.requestMetadata.streamInfo={...this.requestMetadata.streamInfo,redirect:t},this.requestMetadata.isUMP&&!this.requestMetadata.isSABR?{done:!0}:void 0}handleSabrContextUpdate(e){const t=this.decodePart(e,gt);t&&(this.requestMetadata.streamInfo={...this.requestMetadata.streamInfo,sabrContextUpdate:t})}handleSabrContextSendingPolicy(e){const t=this.decodePart(e,kt);t&&(this.requestMetadata.streamInfo={...this.requestMetadata.streamInfo,sabrContextSendingPolicy:t})}};t(zt,"SabrUmpProcessor");var Gt=zt;export{Lt as SABR_CONSTANTS,qt as SabrStreamingAdapter,Gt as SabrUmpProcessor};